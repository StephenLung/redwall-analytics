---
title: Evaluating Mass Muni CAFR Textract Results - Part 5
author: David Lucey
date: '2020-04-24'
slug: evaluating-mass-muni-cafr-textract-results-part-5
categories: ["R", "Code-Oriented"]
tags: ["pdf", "pdftools", "tabulizer", "textract"]
output:
  html_document:
    code_folding: yes
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<link href="/rmarkdown-libs/jsoneditor/jsoneditor.min.css" rel="stylesheet" />
<script src="/rmarkdown-libs/jsoneditor/jsoneditor.min.js"></script>
<script src="/rmarkdown-libs/jsonedit-binding/jsonedit.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<pre class="r"><code># Libraries
packages &lt;- 
  c(&quot;data.table&quot;,
    &quot;reticulate&quot;,
    &quot;paws.machine.learning&quot;,
    &quot;paws.common&quot;,
    &quot;keyring&quot;,
    &quot;pdftools&quot;,
    &quot;listviewer&quot;
    )

if (length(setdiff(packages,rownames(installed.packages()))) &gt; 0) {
  install.packages(setdiff(packages, rownames(installed.packages())))  
}

invisible(lapply(packages, library, character.only = TRUE))

knitr::opts_chunk$set(comment=NA, fig.width=12, fig.height=8, out.width = &#39;100%&#39;)</code></pre>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In <a href="https://redwallanalytics.com/2020/04/14/scraping-failed-tabulizer-pdfs-with-aws-textract-part-4/">Scraping Failed Tabulizer PDFs with AWS Textract - Part 4</a>, we showed how to use pdftools and tabulizer to subset a group of PDFs, the AWS paws SDK package to store the PDF in S3, and Textract machine learning to extract a block response object using its “asynchronous” process. Subsequently, we discovered an alternate route to save the desired pages as PNG and send those page-by-page to AWS to get the same result. This method has the added advantage of being free to free-tier AWS users.</p>
<p>In this post, we will show how to do this, and also how to parse the complicated response blocks (shown in Figure <a href="#tab:list-view"><strong>??</strong></a>), which took us a few days to figure out. As mentioned previously, the response blocks are complicated, with one nested list pertaining to text and another to the coordinates on the page. We attempted to write R-code to extract the required data, but in the end, decided to modify the AWS code, and call it within RStudio using the reticulate package. This had the added benefit of bringing together several pieces we had been working on.</p>
</div>
<div id="convert-selected-page-to-png-with-pdftools" class="section level1">
<h1>Convert Selected Page to PNG with pdftools</h1>
<p>Below we show the steps extract the Balance Sheet (page 27) from the Attleboro CAFR as a png with pdftools “pdf_convert” function. At first, we used the default setting for dpi of 75, but we found that the resolution this was too fuzzy, and led to frequent errors on particular letters with the OCR. These were not eliminated, but significantly reduced once we switched to dpi of 200, but it seems like it might be beneficial to go even higher, because for example, the “l” was commonly dropped when it occurred at the end of a word (ie: “Governmenta”).</p>
<pre class="r"><code># Point to particular muni pdf on disc
pdf &lt;- 
  paste0(&quot;/Users/davidlucey/Desktop/David/Projects/mass_munis/data/pdf_cafr/attleboro_2018.pdf&quot;)
  
# Create png name for muni
png &lt;- 
  paste0(&quot;/Users/davidlucey/Desktop/David/Projects/pdf_cafr_parse/attleboro.png&quot;)
    
  # Convert report to png
pdf_convert(
  pdf, 
  format = &quot;png&quot;, 
  pages = 27, 
  filenames = png, 
  dpi = 200)</code></pre>
<pre><code>Converting page 27 to /Users/davidlucey/Desktop/David/Projects/pdf_cafr_parse/attleboro.png... done!</code></pre>
<pre><code>[1] &quot;/Users/davidlucey/Desktop/David/Projects/pdf_cafr_parse/attleboro.png&quot;</code></pre>
</div>
<div id="extract-page-with-aws-textract-synchronous-operation" class="section level1">
<h1>Extract Page with AWS Textract Synchronous Operation</h1>
<p>We input our AWS credentials and set up a Textract response object in the same way as in the previous post. One difference between synchronous and asynchronous (demonstrated in the last post), is that paws sends the request and gets the response with just the “analyze_document” function call, instead of “start_document_analysis” and the second “get_document_analysis”. We also did not need to loop, because each page fit within the maximum of 1000 blocks, and was immediately returned without a second function call.</p>
<pre class="r"><code># Call Textract for particular muni pdf page
response &lt;-
  svc$analyze_document(
    Document = list(
      Bytes = png
      ),
    FeatureTypes = list(
      &quot;TABLES&quot;
      )
    )</code></pre>
</div>
<div id="description-and-list-view-of-textract-response-object" class="section level1">
<h1>Description and List View of Textract Response Object</h1>
<p>In the chunk below, we show the anatomy of the response object. The first 10 tabs in the listviewer below have the PAGE and some LINE elements, which are the parents of WORDS and CELLS. The TABLE block is shown in element 421, with its 168 children. WORDS and CELL blocks are shown in lines 161-170 and 422-430, respectively. CELL and WORD blocks hvae no children, but can be used to find the location or row-column coordinates of a WORD. We spent a lot of time trying to understand the relationships between the different kinds of objects in order to parse it out in R, but in the end, it seemed easier just to use AWS’s pre-built Python parser.</p>
<pre class="r"><code># View of first block
listviewer::jsonedit(
  response[[&quot;Blocks&quot;]][c(1:10, 161:170, 421:430)]
)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:768px;" class="jsonedit html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"BlockType":"PAGE","Confidence":[],"Text":[],"RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":1,"Height":1,"Left":0,"Top":0},"Polygon":[{"X":0,"Y":0},{"X":1,"Y":0},{"X":1,"Y":1},{"X":0,"Y":1}]},"Id":"4825fe0f-6fd1-4bc8-96d7-7bf00e0acaf1","Relationships":[{"Type":"CHILD","Ids":["23645e62-8933-44c9-a130-079c4c0f10c5","0f5dce29-3a8f-457d-afb3-16e86882471d","dcb0a06c-9e42-4fe9-b54a-783a37bf72d5","299c0044-b461-424e-bdb9-b2aff6563a48","7b607e3d-e046-4a61-8441-af7218f21beb","3f0907ce-5caf-4252-ad77-ffa527fe2751","5cdce167-2094-4c31-b93d-f08a8b99cb66","9b92d339-04b3-4d27-b9be-4f2bed04aa84","883417a1-0ca8-45dd-b5f1-bbf98c840b93","34d827f0-be80-427b-b848-444266b42ed8","b3add4ab-a18b-4042-9a6f-55a171ca4410","1ebeef0c-3a4d-49de-8289-44363297678a","5cbb5d60-a9a2-46a5-bdff-f8708efa14d9","e8e79dcb-750a-4947-b1a5-9fd2c2130283","5752dc69-78aa-474a-9e76-1107bf19daca","714c1c64-d34b-4412-ab5d-0d0525294439","fbe23aad-0b58-4d30-8ac2-31acac6c7f67","10bf7648-f62a-484e-8f25-725d3bb03c7d","68bc4449-d9e7-4342-b1d5-921c9a405af6","f2d75bdc-a34c-4100-86d1-1808d61db43b","fb042c04-7ae9-4b75-b939-0a99b9a67247","590b12f8-4753-4eb8-ab5f-97c5a07c8c35","b3b0c00a-47ab-48eb-8ab5-90e21d05b321","fababe69-c2ab-4ed7-82d9-0787084dd757","5a8ef4ac-52e8-49a9-92d1-8adeb513755c","a15d112b-fa1f-49ff-afa3-8c87e442e0e2","b470c6b8-3fa8-447f-a88d-e73078443e1d","2ff89dfe-4a4c-4fdf-9c90-3cab5a72504f","da26e73c-f056-405b-a603-ce1574665146","09edc80c-21f3-41cb-b73d-48badf3c623f","dafcb759-facd-4f91-b162-beac218f914d","cea02fbe-73b2-4ab1-9b4b-8615bf813d0f","ce3152a8-e28c-42bd-9b76-6f74e2531c11","21170c79-7fde-4932-9ffa-9a867a2ff52c","7903ccd1-85b9-4613-b7f0-4e8713a61461","6c4edec5-c524-4ece-a120-b5c3eadff694","9da827ac-dcb1-4ce6-9cb2-3661c78b0cdf","8fb6f4fc-926d-4f78-8281-007a72577b5b","2566721c-47d9-4496-9e4b-2eaca58cb662","0b9e2f0c-8d39-41f4-b3ac-770006675f11","b682c599-2638-482e-97d8-27d525513f00","e2376ee5-1f6f-4767-8734-7b4744250415","b89343b1-6bcf-4e6b-88d3-fb2fb2691f9a","093a30fd-e0ce-4105-bfac-1e946c4c43a1","d922a9c9-c66c-478d-9fbf-009d04a86570","08cf56a8-8460-464e-b716-011c2aac3857","b6596631-75ff-4571-9e2d-3f85cbe6f22b","0e6a1e69-ba0f-4919-b45e-0db0f67c5511","642920ad-699b-4ba7-b05c-f91f8287986a","49a17fee-7daf-48d5-8c82-35a7f910147c","c9ee53ab-bae8-4432-8dad-8745e1ff031f","f3518ca7-fda2-4257-b667-44e73f454163","6bb3aece-c3f6-40a3-8907-0ddf798cda0a","cfb6d462-c393-483c-8c7d-df609583614c","3ba3f01b-3fb9-4802-aa79-17e83779a0d4","ee36d72a-bedf-405e-89a9-ddbb8a457982","c1860f6d-7138-4b6d-a3c6-c97e4a92c0cb","ff0cf3a0-4e0f-4ed1-9dcf-4c71985d862c","7d4a766e-f961-4384-b815-881bc0eac92d","844e1992-ad4e-496c-adb5-7d73c48dd795","53d04775-cd7f-4648-8a31-9fb7bbe2692b","ce2a69ad-d9e3-4d0d-9a84-fc39d14666ef","bdb09a40-cca5-4ebf-b711-56b22ec5a12f","c481ebea-d56c-440b-a598-214e2bf9a929","c420113d-f583-4cb5-be71-ad9d6ee4a870","f52210a8-1248-4b9b-8294-b759925c98e6","cdbcfd9a-b3fa-4a47-a5db-f3f30c6e6dfe","b9c0d58e-a591-4019-9a20-184e68cae24a","1c8d5297-53ac-4d94-8be3-5ed8118ee4bd","8361b98b-6ab1-4093-ab16-c0ecb62bb096","fc800dd0-1663-4816-b904-e37a67890d84","63eb5562-7509-402b-93b7-627e45c1797f","ecd1400a-f41a-40aa-b94f-7c61aac963c0","e6067413-9569-4fbe-b662-772f81b00ba6","9319b03b-47df-4f17-9e35-8ba26a7c89c8","a75a0ebf-76b0-410b-b7ff-431156642f07","de9b6f0f-5b79-49f9-8a89-ecb9cace829e","da0d2aea-2890-4609-92f5-fc2b5a66e51b","9556bb7d-fe7d-4d09-a833-36a685066dda","4631a801-882d-4d92-af9b-763caa441ca5","075bdd16-c1cf-4091-b306-130c7f3006bc","39f2210b-d065-4560-9514-fc17e635be66","5262323e-7391-4109-9f47-fc3ac46977ff","37d64c6a-3598-46d1-8d5a-6596df4d1c46","9449711b-59b2-4d2e-8332-20ac91b9f25f","94b0bf98-7fc7-4000-b915-6149a423a2e2","9ca5b35d-9be8-457d-96db-6c5ecd0217e5","e764c83a-8c19-41e6-a00b-e4f539c125be","442c2c3e-511a-4223-864d-73a22e337535","92b2a70c-0845-4cb6-ac3d-b681f12e6e17","84d09475-45ad-4ca3-ba5b-201db6efa185","f99e073d-f284-4102-944f-16270209f517","424fdbe2-b9ac-430a-bb0f-5b2806e75aa0","75591f1d-5dbe-48ae-ab10-97622edc6849","10a4b83d-0a58-461f-b4e0-d4d5b100791b","a7704d7f-d472-49be-81e5-c180bdc9b5e5","a2a96ee5-1417-41c0-be6f-520606c4b284","4657083c-8d74-4fed-8914-de7f44991ec8","830febad-9ec3-4331-a70e-12469627b03a","1771df40-c116-4cd2-98e3-f3bc219e072b","912b5f09-4729-4406-bfdb-e079a1b7d70d","9a28ee43-2aa0-4c41-a9ac-6924272aa11b","2001905a-fcdd-41d5-b24a-e31a47f119a1","e119de9a-40f9-43bf-990e-61453ff21549","34400cd5-afca-4ba7-a62a-d9f7001df6f9","7e87435d-d1b3-4d34-a441-9714981c1df5","269d2f6a-f687-4a9a-83ad-98a956fbca0e","7717b9f4-6c31-464e-8c2d-0b40d5bc6e64","b97f6225-6058-4f79-998f-c5cca48da404","d6fba0b8-d309-4ef8-9333-d1409ebbd2ea","d7478ed6-1742-4709-98de-0c882a9543a8","be4f9166-e4f9-4c4d-81e4-bcaf55474cd8","b4eae797-f2e0-4f71-8646-c90bd7004330","613e5f5b-ca40-4ba3-b96b-52df67689ba9","93113e41-dbdc-4b0e-9f95-313ba0eecad2","5155cc6f-c77e-4d92-ac71-fad34351e5c3","a9150433-a5bb-4b3f-a050-d6af56090f13","a051dc83-bd5f-4901-b808-842694e00538","214dca1e-27e1-440a-8616-513e3085a2db","a4967fb6-712f-4184-a492-eb7e11225099","d86421f1-d25e-4692-aa5f-0b3a15be80ea","509e47ef-13d6-42ea-8360-b67149e04d65","57ee6b0b-b533-4b8a-85ed-b3ef2ef59b82","7c19057d-e067-44a7-b634-f940c9db8efb","2a53e08b-77f6-450e-bcb1-0a5a3b716a53","dee0f751-020e-4b4b-819d-742012de1734","c730c7a8-6fe2-43c6-a7d3-a97e1aa2bbe1","a3773c4f-3fd0-4572-858e-a4dfb6612a3a","d44c4dc8-7ad1-49fd-97a3-df9f612eff7b","e76a825f-d4ab-4248-bcdf-a4c14f143479","5e9da3a6-a16c-428d-8ea0-e229649b1b9a","1946133e-da1a-463a-bab4-df70024c0a24","aa460b76-dac5-4dd1-a0b9-6ea7fb1a1590","f9f7dcb6-f7d2-45c8-bd79-8a8e1ddea2ec","ca921424-0d2a-4dd8-a12c-a6180eab53c5","3c8f2057-d167-479a-aeb0-0ce6b76092e4","d4f7b6c2-e930-4ad9-9283-2d956533b8db","3a64f284-ff9a-4b20-a779-a8be597ae45f","5e87680f-7200-4c16-8f75-4a17f00487fe","6983469c-e329-4182-922a-4d7f592d93a7","c55e44ca-2a42-4a07-a754-7da10c641828","152c5d8c-edc2-4443-a895-b458d22bc928","7abcb03f-9836-4943-a370-97e15ca7b6e7","f220075a-1685-46bd-883b-89992acbc49c","8fdbfed1-87c1-4a0e-b030-2b487eb1cb93","375d7d68-4489-4b7b-b9e3-4d0196b04296","4e7f5f18-0a61-4cc8-85d4-71ca4992dbed","2808edc1-c6be-481b-a9b1-333f919f6d6f","ea94a2ab-9cf0-40e5-86b6-dca6631dd6fa","97b0506f-4149-4e96-aefd-b5e284d5e139","b7c54553-d394-454e-b0c6-55290d0a903b","7c4b9dc0-9ec2-4525-8586-f3c0565c96ca","32dc7c3b-cc82-43e8-afd0-dc2b4fb0effe","341b2d1f-49cd-405d-bb15-11b745e93ea5","43ebbb8e-e5c1-4f33-a27c-75745fddcc64","92e909e6-aff0-4d61-9a38-52e05a3452bf","5591cf37-d9a2-4ff3-a6d4-10a690c3f345","6e8219bb-28a8-4e36-9d6f-30cacd390fbb","c5ad042b-d075-417b-b22a-c435fe772d01","f7d945d3-bfbe-4b4a-b1b7-e8806e6b34e4","10ba54f8-b8de-4f56-9b93-478e27adf3b4"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.8729019165039,"Text":"CITY OF ATTLEBORO, MASSACHUSETTS","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.328200131654739,"Height":0.0120920054614544,"Left":0.347566157579422,"Top":0.0480296947062016},"Polygon":[{"X":0.347566157579422,"Y":0.0480296947062016},{"X":0.675766289234161,"Y":0.0480296947062016},{"X":0.675766289234161,"Y":0.0601217001676559},{"X":0.347566157579422,"Y":0.0601217001676559}]},"Id":"23645e62-8933-44c9-a130-079c4c0f10c5","Relationships":[{"Type":"CHILD","Ids":["ade16b83-910a-45d9-8602-a71e63338895","fc4cf3de-ce2d-40dd-8c0c-99fbf0877d14","620f8dc9-de13-4fa4-8ef1-7c221ce92f3f","c21293b9-b6f9-4ba0-9200-400d330b9e96"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":90.2096252441406,"Text":"Balance Sheets - Governmental Funds","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.249993175268173,"Height":0.0105019323527813,"Left":0.386319369077682,"Top":0.0618089847266674},"Polygon":[{"X":0.386319369077682,"Y":0.0618089847266674},{"X":0.636312544345856,"Y":0.0618089847266674},{"X":0.636312544345856,"Y":0.0723109170794487},{"X":0.386319369077682,"Y":0.0723109170794487}]},"Id":"0f5dce29-3a8f-457d-afb3-16e86882471d","Relationships":[{"Type":"CHILD","Ids":["203d6753-aa2a-4066-93eb-fab0ddaa81c8","c386dd87-cecc-4b7c-b35d-6b3d0be43180","b5cc2dd4-bf94-447d-bb28-47aa18410a02","e8d4a788-78fc-45d0-9f94-fdaae566f3f7","f2e7c97b-c8d8-479b-b94e-6f51a2a62e3c"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.7061462402344,"Text":"June 30, 2018","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0914927572011948,"Height":0.0110378693789244,"Left":0.46528360247612,"Top":0.0768411457538605},"Polygon":[{"X":0.46528360247612,"Y":0.0768411457538605},{"X":0.556776344776154,"Y":0.0768411457538605},{"X":0.556776344776154,"Y":0.08787901699543},{"X":0.46528360247612,"Y":0.08787901699543}]},"Id":"dcb0a06c-9e42-4fe9-b54a-783a37bf72d5","Relationships":[{"Type":"CHILD","Ids":["660fae45-5c30-4054-beef-df1e69440bdd","555ab503-2fe2-40f1-8525-39154f08df3e","bf738c94-c48f-4077-8a61-d34304162e3a"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.8734436035156,"Text":"Major Fund","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0682311207056046,"Height":0.00993594620376825,"Left":0.515842616558075,"Top":0.141945227980614},"Polygon":[{"X":0.515842616558075,"Y":0.141945227980614},{"X":0.584073722362518,"Y":0.141945227980614},{"X":0.584073722362518,"Y":0.151881173253059},{"X":0.515842616558075,"Y":0.151881173253059}]},"Id":"299c0044-b461-424e-bdb9-b2aff6563a48","Relationships":[{"Type":"CHILD","Ids":["1f8cd3bc-924c-416b-aada-4527e247a882","63eaa965-9719-45e5-9dfd-a6ad1fe053a2"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.8324737548828,"Text":"Non-Major","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0642843842506409,"Height":0.00987696647644043,"Left":0.632385730743408,"Top":0.142111480236053},"Polygon":[{"X":0.632385730743408,"Y":0.142111480236053},{"X":0.696670114994049,"Y":0.142111480236053},{"X":0.696670114994049,"Y":0.151988446712494},{"X":0.632385730743408,"Y":0.151988446712494}]},"Id":"7b607e3d-e046-4a61-8441-af7218f21beb","Relationships":[{"Type":"CHILD","Ids":"7a95f907-7f10-4090-b601-81c38b23bf16"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.8507385253906,"Text":"Total","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0291486978530884,"Height":0.00818844139575958,"Left":0.756369709968567,"Top":0.141900286078453},"Polygon":[{"X":0.756369709968567,"Y":0.141900286078453},{"X":0.785518407821655,"Y":0.141900286078453},{"X":0.785518407821655,"Y":0.150088727474213},{"X":0.756369709968567,"Y":0.150088727474213}]},"Id":"3f0907ce-5caf-4252-ad77-ffa527fe2751","Relationships":[{"Type":"CHILD","Ids":"0bfbd2f9-4903-46dd-80f6-9f006c09cf3f"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.9212188720703,"Text":"General","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0465574860572815,"Height":0.0081067681312561,"Left":0.526444971561432,"Top":0.155113011598587},"Polygon":[{"X":0.526444971561432,"Y":0.155113011598587},{"X":0.573002457618713,"Y":0.155113011598587},{"X":0.573002457618713,"Y":0.163219779729843},{"X":0.526444971561432,"Y":0.163219779729843}]},"Id":"5cdce167-2094-4c31-b93d-f08a8b99cb66","Relationships":[{"Type":"CHILD","Ids":"78399bee-fa8b-4a3f-891b-f74a3acd4516"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.8980407714844,"Text":"Governmental","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0821431279182434,"Height":0.00816278159618378,"Left":0.623451232910156,"Top":0.155176013708115},"Polygon":[{"X":0.623451232910156,"Y":0.155176013708115},{"X":0.7055943608284,"Y":0.155176013708115},{"X":0.7055943608284,"Y":0.163338795304298},{"X":0.623451232910156,"Y":0.163338795304298}]},"Id":"9b92d339-04b3-4d27-b9be-4f2bed04aa84","Relationships":[{"Type":"CHILD","Ids":"e7afb14b-5b06-4d1e-96a6-a4e26f0f52cf"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.7160110473633,"Text":"Governmental","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0823081135749817,"Height":0.00805313885211945,"Left":0.729603290557861,"Top":0.155253916978836},"Polygon":[{"X":0.729603290557861,"Y":0.155253916978836},{"X":0.811911404132843,"Y":0.155253916978836},{"X":0.811911404132843,"Y":0.163307055830956},{"X":0.729603290557861,"Y":0.163307055830956}]},"Id":"883417a1-0ca8-45dd-b5f1-bbf98c840b93","Relationships":[{"Type":"CHILD","Ids":"6e7bb6b9-5d74-4a1b-85b2-f14f3a2ef82e"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"LINE","Confidence":99.6132431030273,"Text":"23","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0162584781646729,"Height":0.00991564989089966,"Left":0.877289533615112,"Top":0.94217586517334},"Polygon":[{"X":0.877289533615112,"Y":0.94217586517334},{"X":0.893548011779785,"Y":0.94217586517334},{"X":0.893548011779785,"Y":0.95209151506424},{"X":0.877289533615112,"Y":0.95209151506424}]},"Id":"f7d945d3-bfbe-4b4a-b1b7-e8806e6b34e4","Relationships":[{"Type":"CHILD","Ids":"82b3df1b-c11d-4dfc-a1db-d5c9a0de4d5a"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.8464279174805,"Text":"CITY","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0402611792087555,"Height":0.0097391651943326,"Left":0.347566157579422,"Top":0.0480296947062016},"Polygon":[{"X":0.347566157579422,"Y":0.0480296947062016},{"X":0.387827336788177,"Y":0.0480296947062016},{"X":0.387827336788177,"Y":0.0577688589692116},{"X":0.347566157579422,"Y":0.0577688589692116}]},"Id":"ade16b83-910a-45d9-8602-a71e63338895","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.8058242797852,"Text":"OF","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0223059002310038,"Height":0.00958989374339581,"Left":0.392359346151352,"Top":0.0481834784150124},"Polygon":[{"X":0.392359346151352,"Y":0.0481834784150124},{"X":0.414665251970291,"Y":0.0481834784150124},{"X":0.414665251970291,"Y":0.0577733740210533},{"X":0.392359346151352,"Y":0.0577733740210533}]},"Id":"fc4cf3de-ce2d-40dd-8c0c-99fbf0877d14","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.9326400756836,"Text":"ATTLEBORO,","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.107775151729584,"Height":0.011679220944643,"Left":0.418294250965118,"Top":0.0484424829483032},"Polygon":[{"X":0.418294250965118,"Y":0.0484424829483032},{"X":0.526069402694702,"Y":0.0484424829483032},{"X":0.526069402694702,"Y":0.0601217038929462},{"X":0.418294250965118,"Y":0.0601217038929462}]},"Id":"620f8dc9-de13-4fa4-8ef1-7c221ce92f3f","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.9067230224609,"Text":"MASSACHUSETTS","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.14466156065464,"Height":0.00988541170954704,"Left":0.531104743480682,"Top":0.0481386780738831},"Polygon":[{"X":0.531104743480682,"Y":0.0481386780738831},{"X":0.675766289234161,"Y":0.0481386780738831},{"X":0.675766289234161,"Y":0.0580240897834301},{"X":0.531104743480682,"Y":0.0580240897834301}]},"Id":"c21293b9-b6f9-4ba0-9200-400d330b9e96","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.9431304931641,"Text":"Balance","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0523790083825588,"Height":0.00984100997447968,"Left":0.386319369077682,"Top":0.0619753412902355},"Polygon":[{"X":0.386319369077682,"Y":0.0619753412902355},{"X":0.438698381185532,"Y":0.0619753412902355},{"X":0.438698381185532,"Y":0.0718163475394249},{"X":0.386319369077682,"Y":0.0718163475394249}]},"Id":"203d6753-aa2a-4066-93eb-fab0ddaa81c8","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.4727172851562,"Text":"Sheets","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0427423417568207,"Height":0.010501935146749,"Left":0.442787200212479,"Top":0.0618089847266674},"Polygon":[{"X":0.442787200212479,"Y":0.0618089847266674},{"X":0.485529541969299,"Y":0.0618089847266674},{"X":0.485529541969299,"Y":0.0723109170794487},{"X":0.442787200212479,"Y":0.0723109170794487}]},"Id":"c386dd87-cecc-4b7c-b35d-6b3d0be43180","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":52.0821380615234,"Text":"-","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.00572196999564767,"Height":0.00258046993985772,"Left":0.489485532045364,"Top":0.0671662613749504},"Polygon":[{"X":0.489485532045364,"Y":0.0671662613749504},{"X":0.495207488536835,"Y":0.0671662613749504},{"X":0.495207488536835,"Y":0.069746732711792},{"X":0.489485532045364,"Y":0.069746732711792}]},"Id":"b5cc2dd4-bf94-447d-bb28-47aa18410a02","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.9017562866211,"Text":"Governmental","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0939368978142738,"Height":0.00983215030282736,"Left":0.498926401138306,"Top":0.0621132105588913},"Polygon":[{"X":0.498926401138306,"Y":0.0621132105588913},{"X":0.592863321304321,"Y":0.0621132105588913},{"X":0.592863321304321,"Y":0.0719453617930412},{"X":0.498926401138306,"Y":0.0719453617930412}]},"Id":"e8d4a788-78fc-45d0-9f94-fdaae566f3f7","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.6483993530273,"Text":"Funds","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0394137389957905,"Height":0.00992638245224953,"Left":0.596898794174194,"Top":0.0620685778558254},"Polygon":[{"X":0.596898794174194,"Y":0.0620685778558254},{"X":0.636312544345856,"Y":0.0620685778558254},{"X":0.636312544345856,"Y":0.071994960308075},{"X":0.596898794174194,"Y":0.071994960308075}]},"Id":"f2e7c97b-c8d8-479b-b94e-6f51a2a62e3c","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"WORD","Confidence":99.6132431030273,"Text":"23","RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.0162584707140923,"Height":0.00991563033312559,"Left":0.877289533615112,"Top":0.94217586517334},"Polygon":[{"X":0.877289533615112,"Y":0.94217586517334},{"X":0.893548011779785,"Y":0.94217586517334},{"X":0.893548011779785,"Y":0.95209151506424},{"X":0.877289533615112,"Y":0.95209151506424}]},"Id":"82b3df1b-c11d-4dfc-a1db-d5c9a0de4d5a","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"TABLE","Confidence":99.999870300293,"Text":[],"RowIndex":[],"ColumnIndex":[],"RowSpan":[],"ColumnSpan":[],"Geometry":{"BoundingBox":{"Width":0.637475669384003,"Height":0.750814855098724,"Left":0.188179790973663,"Top":0.125344067811966},"Polygon":[{"X":0.188179790973663,"Y":0.125344067811966},{"X":0.825655460357666,"Y":0.125344067811966},{"X":0.825655460357666,"Y":0.876158952713013},{"X":0.188179790973663,"Y":0.876158952713013}]},"Id":"10ba54f8-b8de-4f56-9b93-478e27adf3b4","Relationships":[{"Type":"CHILD","Ids":["5d9096ca-6554-4e2f-9be0-a27662ed77cc","7a7581c7-b4bb-4a6f-aac9-dcd745636bce","c4e54589-5045-4e19-942e-01642ee859bf","163e49ca-8bfb-4195-b6ae-abd3229a62de","4963da70-f8f0-4b85-8b60-3a1caeeec182","b3d8c284-cba4-45d5-8090-060deb1c5021","5bc180e4-215e-4ab7-960f-8824db75cc2f","7961ac4c-31d1-4336-88e0-158947be19d0","93a3b628-b150-4d1e-895a-61c26789d85e","96f155ac-a507-4c2d-bdb9-b32682edb847","692b3866-32c0-4fec-aa6e-d45dfc6fbe82","a90b1fe8-2dc9-48d1-9d34-dda542e36c62","8def448a-18cf-43c5-944d-f3bc36cbb70f","628d0356-ea08-4e48-8db1-cccaef072e8a","e551b77e-9757-48b1-98f2-d754c938392a","213c37cd-1645-4c34-9fbc-cfb22ecee2b6","e9c28aa5-400e-4b1a-abf6-2540e229c2b6","6d98dab2-1091-4a58-a960-3450854d57eb","99556f63-9e12-4680-8963-3f5fdf76b47e","f959b61b-ce0f-457d-b0ad-f5c0e1ce37f2","de23eb25-b92e-495b-9275-d74e0ae183ee","29b7ec59-3c92-4db2-8c93-85af6fe0abab","d478cc0b-4ebc-4d0f-be58-afa58d3b0476","9e002c00-faae-4216-b39d-e4118a1366ef","2a24532e-ae18-499e-937c-387d6ea69bf0","f4edfa87-3641-40d5-a9a9-b9d291118d14","0d9b986f-d58a-4941-a8a5-ced0d72af320","e946793f-7c89-4184-9986-78dc2dab875c","ef72867f-8a97-40a8-b4b8-1dd1e468ff27","c2fbe370-3ce7-4346-b1ce-ce33b93f0072","b3ce663d-401c-49f5-a7fa-05cd5051e614","03b2ab05-f630-4732-802b-a278dbcc6186","3c5c3257-e8bd-468d-a7e9-872e1e222ad1","2ffabe2c-ca47-4dd4-9fe1-d7d07f7f390c","6f1837b6-e575-4873-a6ce-57111540a025","595af21a-52ef-4ebe-9ee0-8013078d5943","6278fbad-1163-42cf-bc9a-d96d96059c22","295912e3-5b45-43f0-af86-3679f4e5962e","966ba0af-1dad-4a09-9f93-741aa55e7962","7467bdce-6215-4393-9b25-e938aca0ba0e","818c4355-30e0-4e15-8b5c-e0217a14630a","eef86f30-513c-44f4-b2e3-33dee60ecf04","2008b6a0-20a9-480f-b23e-b82bddf88299","65391dc1-3721-4bff-9bde-75953dfce473","3d85319b-b08f-4b3e-b6ba-47816f8cbb81","ed7a9565-9d57-489e-9fe4-5b0cddd551af","a6ea26e2-1654-487b-a445-841e03382433","bd2ae350-8208-4b4c-8a46-d23652ba11c8","84776e55-af84-465b-8d3e-506b0928efe0","abc36d54-7b80-4a7b-8153-1766467b6b06","b63cb910-dcb8-4630-9960-86105ccaa5f1","1a0b45ed-4131-4c80-b34d-223a1dd0da8e","ec15e1a4-1d18-4e51-a87f-8a0ff2b7e091","4b2baa68-6935-4e07-8719-b091a4ee4731","6a02eb16-4866-4640-8193-37cb57abe98e","91eb689b-384d-4b74-8ffc-e48474c706ba","b95f9a8c-7008-46e2-9599-0bd2f7afac7e","dc29e815-fdc3-4ccb-9f9d-950f3483bee9","4c44bedc-a7d8-4b96-a188-f83983a42644","d45394da-0060-42c7-a6fd-d894d76b6b98","ac908d95-0d0f-460f-a9fe-e01c27c7187d","8adb5e51-f851-4fee-b3c9-f758f44f55df","00aeb5c9-5fdf-45db-a668-79de97d06ac4","9580bd3e-5705-444f-a37c-1ca77f0a6d20","aa36f133-0123-461c-8262-b4cbb56f35c8","d5675355-afa3-44e5-8908-13db8bba720d","b85d746a-87a0-4d6a-b7c7-383a01fbc92a","94ff8993-a0b9-4317-99f8-24b9710a7d42","85776a38-ff13-44d2-8f00-b580932492a9","073350f9-aeb6-47c7-8e18-c70eb5ab839b","3015a2fe-dae8-4131-9b06-2e024f9e3d0e","57dce39f-9705-41af-a946-b265701376a2","f754bd26-675b-44e8-be31-c8b53cc507b6","0874419d-23a9-4055-9ab7-7441fb49b6dc","0d5c9414-f470-4d79-928a-1cb847314536","efd5ba12-18ff-46e9-87df-96fb161fde0b","a18a7397-6f0c-46f6-8bcb-18c86c8b783a","9cee4f6a-d737-47a2-bd3f-996f13328924","3f51dce5-29e8-4805-aae4-7c4b8fb2a374","cac945e3-68aa-40f9-b90d-3578338534d9","8a966fc1-c7c8-4c42-bdaf-52c98d09d028","13059c5e-ee25-44e3-9fa5-a88d70268bcb","98a049fa-cd94-4576-a1a7-5910edb9f326","6fa44b47-3168-4116-bf11-fec029dbdaf3","1fec8694-5caa-48e1-806b-4d66aa9d0f80","ee68c9f3-b4ed-4fe7-9eb5-0457156ffd87","f4da6702-9cd1-42e6-8801-3e81739bcda5","7cb5b7a8-3851-43d4-8cea-a677f588f9fa","109cf89d-33b5-45cb-9388-9241415939cc","e375881a-bba7-45bd-b853-aee01887d152","50ca151a-588b-4505-b4d7-b9a2761a3b85","ab08475b-c0e9-431d-882c-5db82355470f","ddf7fc36-ac53-4761-bc17-46f53c5da2b3","63e15f04-120b-4c30-88c3-2e9e3fa877f3","78dcf84a-d96c-4a5d-8fa9-53387531ea6f","a678d6af-6bc2-4085-8aa5-2abaa276ad1d","1a180214-0b58-4e7d-8dae-a2a36a9c365f","bfb259d1-ba2e-4b24-85b0-2c3831cdfeb4","91a26757-fbd8-4d34-9bea-20816089d4f6","67f02e87-263d-4819-ad7e-48fae712f0c1","ffbedfd9-908a-48bd-bcdf-5e866045f7f3","cbfe66c0-b39c-42c0-8906-89054bce7956","b948d6b0-9048-4e64-bb46-69efe10f1b22","8a55fe62-9ee9-43d9-8c09-3054724320bd","f243b8a6-a8ea-434f-8c93-11e40a022bc0","7b66d25a-2c0f-4344-a5f6-7c80f7454a71","3871cd83-82c2-4d7c-87d8-12f7a596305f","ac4b55b9-bade-4d83-88ba-c8afcf806334","c2e7a5a5-d7b1-4acc-8f34-7d8afcf9fb02","68b74a8e-1c93-470c-870d-a8e04d18a6af","8416fa5a-e5f7-410c-94b9-33d7bd6b55ae","8ca46931-9481-4f92-b29a-658d0b581640","3aaebfde-090a-45cd-8932-7323e6fc4991","1f441b02-b31e-4ad1-8a02-96266b4cca26","fa691084-c804-4ef0-a3e2-fc2b65316b13","a1d6d933-b6b4-4c64-8d98-033401811252","86661a89-9e49-4654-b00a-1dbc7bb4f463","90bce3e9-666c-4d3a-b56d-b51e860633f4","4c0e2f24-7d63-49e6-8126-125c3fa2c64e","2f0f3d45-36ec-4704-b997-ca40a01f8591","80d775a8-ad99-4e75-b5df-6ee1f537cb6c","6fe2febe-3573-4e19-9459-29ddbcbd1a69","ff98b032-2d87-4011-b227-79e493add102","08018cd2-01e7-4c09-acd1-6aee82bdace8","e3f25999-465d-4a9e-98a0-70632d4896d9","808496a8-f611-4635-84c2-f7918bf199e2","5a57d19e-3cda-4346-b98b-c13d69efac05","c432514a-f807-4948-9922-cf650d2c61e8","20d53019-b6d4-4da9-a822-fd6130f17747","605fc37c-2f15-419d-b7c7-b953929c206f","c03e0e45-8fc1-463f-ab19-a9dbe081c9e0","57a0f542-b140-4332-a234-796c8cf05ba4","445f772a-db29-48eb-98c2-41cdd3e4a58c","3409232f-33e1-4ca4-b057-bfc5de76c832","9583ccab-b591-4329-8f58-4eab9fcd5476","ac9a7215-00d3-490d-8387-368776071277","28bc3f2f-ead9-4200-9e82-b09627cef70a","d946fff7-47b4-4712-881d-d06165e62048","73b04cf8-9cb0-4207-ac5b-70ebaa919be4","6a97dd56-677f-4d48-aeff-d4e91fdeeb1b","fdec12dc-05fc-4322-a954-e4a4648b7de5","530923f5-14d5-4842-9ba5-d93c51c72600","95cbfed2-5cab-4e59-bd2d-2c86e979cdfe","37055de7-471d-48d5-94a8-d9befdbfd8cc","64ebe8ad-c1a0-4603-b081-ae32d335f8de","9e25805c-cb3d-47d1-b3f1-76134f0b17d2","de0e4b2f-9949-43d6-ac8f-9d1bedb369ba","64be619c-9a28-48f7-bb81-1a0cd3b59fb3","d10f8504-2724-480e-b91e-d352ea8a9662","bdbfa438-ddb0-4718-9515-00c6b20fbc4d","09f94cc5-3ceb-472b-8a55-930252c7e1bf","ddd92053-2d05-48eb-b1d8-ff901af754f8","bcd75b33-2d7e-4c51-bec1-5af034e2b6cc","1e9f34d4-5bb5-4278-b17e-c544970ea97d","0b0790e6-071d-413c-8983-67b23d31d52a","a1614d00-0879-46b0-80b4-6a094f7c6c6b","b571419a-84e3-4618-ac3c-4b9f6133300f","da4b2da0-0ff8-463b-b59a-e74c79fc41eb","66f4b9c3-b7de-40f8-8cfa-9a1241d9de25","0bf36835-38ab-47d9-932e-acac400d1409","54457ad3-3e46-482e-a9ce-eb1b8f19f8de","15fcae66-6b5e-4db7-8b33-84943adaafb7","f5c207ba-b5aa-4c82-9656-2eaa703bdd85","3fe509a6-cb0f-4e38-93cc-6d0934c96a36","a883c3cd-5a58-42fd-a9f8-65cec23828f4","7d6e4b78-b795-4add-aef0-cf7943c5ad96","3748b735-712b-482f-9675-99bae7825902","931d5e89-8020-4caa-a979-a3da66d239c5"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":1,"ColumnIndex":1,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.308777272701263,"Height":0.026814816519618,"Left":0.188179790973663,"Top":0.152158886194229},"Polygon":[{"X":0.188179790973663,"Y":0.152158886194229},{"X":0.496957063674927,"Y":0.152158886194229},{"X":0.496957063674927,"Y":0.178973704576492},{"X":0.188179790973663,"Y":0.178973704576492}]},"Id":"5d9096ca-6554-4e2f-9be0-a27662ed77cc","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":1,"ColumnIndex":2,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.11383493989706,"Height":0.026814816519618,"Left":0.496957063674927,"Top":0.152158886194229},"Polygon":[{"X":0.496957063674927,"Y":0.152158886194229},{"X":0.610791981220245,"Y":0.152158886194229},{"X":0.610791981220245,"Y":0.178973704576492},{"X":0.496957063674927,"Y":0.178973704576492}]},"Id":"7a7581c7-b4bb-4a6f-aac9-dcd745636bce","Relationships":[{"Type":"CHILD","Ids":["78399bee-fa8b-4a3f-891b-f74a3acd4516","2703bfdb-1e1e-46e4-8b08-e5b6ea8d31b3"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":1,"ColumnIndex":3,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.106720253825188,"Height":0.026814816519618,"Left":0.610791981220245,"Top":0.152158886194229},"Polygon":[{"X":0.610791981220245,"Y":0.152158886194229},{"X":0.717512249946594,"Y":0.152158886194229},{"X":0.717512249946594,"Y":0.178973704576492},{"X":0.610791981220245,"Y":0.178973704576492}]},"Id":"c4e54589-5045-4e19-942e-01642ee859bf","Relationships":[{"Type":"CHILD","Ids":["e7afb14b-5b06-4d1e-96a6-a4e26f0f52cf","ff04b409-20aa-4f8a-9fb4-964955f5bfbf"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":1,"ColumnIndex":4,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.108143195509911,"Height":0.026814816519618,"Left":0.717512249946594,"Top":0.152158886194229},"Polygon":[{"X":0.717512249946594,"Y":0.152158886194229},{"X":0.825655460357666,"Y":0.152158886194229},{"X":0.825655460357666,"Y":0.178973704576492},{"X":0.717512249946594,"Y":0.178973704576492}]},"Id":"163e49ca-8bfb-4195-b6ae-abd3229a62de","Relationships":[{"Type":"CHILD","Ids":["6e7bb6b9-5d74-4a1b-85b2-f14f3a2ef82e","3f0878c3-bb28-4d47-9d21-360af672bfce"]}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":2,"ColumnIndex":1,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.308777272701263,"Height":0.0251388903707266,"Left":0.188179790973663,"Top":0.178973704576492},"Polygon":[{"X":0.188179790973663,"Y":0.178973704576492},{"X":0.496957063674927,"Y":0.178973704576492},{"X":0.496957063674927,"Y":0.204112589359283},{"X":0.188179790973663,"Y":0.204112589359283}]},"Id":"4963da70-f8f0-4b85-8b60-3a1caeeec182","Relationships":[{"Type":"CHILD","Ids":"8d8c074d-b9e3-48bd-ab8d-c9a0b05b58e4"}],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":2,"ColumnIndex":2,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.11383493989706,"Height":0.0251388903707266,"Left":0.496957063674927,"Top":0.178973704576492},"Polygon":[{"X":0.496957063674927,"Y":0.178973704576492},{"X":0.610791981220245,"Y":0.178973704576492},{"X":0.610791981220245,"Y":0.204112589359283},{"X":0.496957063674927,"Y":0.204112589359283}]},"Id":"b3d8c284-cba4-45d5-8090-060deb1c5021","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":2,"ColumnIndex":3,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.106720253825188,"Height":0.0251388903707266,"Left":0.610791981220245,"Top":0.178973704576492},"Polygon":[{"X":0.610791981220245,"Y":0.178973704576492},{"X":0.717512249946594,"Y":0.178973704576492},{"X":0.717512249946594,"Y":0.204112589359283},{"X":0.610791981220245,"Y":0.204112589359283}]},"Id":"5bc180e4-215e-4ab7-960f-8824db75cc2f","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]},{"BlockType":"CELL","Confidence":99.999870300293,"Text":[],"RowIndex":2,"ColumnIndex":4,"RowSpan":1,"ColumnSpan":1,"Geometry":{"BoundingBox":{"Width":0.108143195509911,"Height":0.0251388903707266,"Left":0.717512249946594,"Top":0.178973704576492},"Polygon":[{"X":0.717512249946594,"Y":0.178973704576492},{"X":0.825655460357666,"Y":0.178973704576492},{"X":0.825655460357666,"Y":0.204112589359283},{"X":0.717512249946594,"Y":0.204112589359283}]},"Id":"7961ac4c-31d1-4336-88e0-158947be19d0","Relationships":[],"EntityTypes":[],"SelectionStatus":[],"Page":[]}],"options":{"mode":"tree","modes":["code","form","text","tree","view"]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="parsing-the-response-object-with-reticulated-python" class="section level1">
<h1>Parsing the Response Object with Reticulated Python</h1>
<p>An increasing amount is being written on how to use reticulate, so we won’t get into great detail here about how to set it up. We used Python 3.7 with miniconda after re-installing Anaconda post the recent upgrade to Catalina, in which Apple re-arranged our whole set-up.</p>
<pre class="r"><code># Choose Python 3.7 miniconda
reticulate::use_condaenv(
  condaenv = &quot;r-miniconda&quot;, 
  conda = &quot;/Users/davidlucey/opt/anaconda3/bin/conda&quot;, 
  required = TRUE
  )</code></pre>
<p>AWS gives the Python code to parse the blocks back into a tabular form [Textract Python Table Parser] (<a href="https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/python/example_code/textract/textract_python_table_parser.py" class="uri">https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/python/example_code/textract/textract_python_table_parser.py</a>). This code built in the call to AWS with the Python boto client, but we didn’t need this so we had to modify to take already returned response instead. A second problem that we encountered was that when the object was parsed over from R into Python, blocks which had multiple children “Ids” were converted to list, while those with single children remained as strings. It took some time, we patched this in the “get_text” function below, so assume it should work for any R user now.</p>
<pre class="python"><code>
import webbrowser, os
import json
import io
from io import BytesIO
import sys


def get_rows_columns_map(table_result, blocks_map):
    rows = {}
    for relationship in table_result[&#39;Relationships&#39;]:
        if relationship[&#39;Type&#39;] == &#39;CHILD&#39;:
            for child_id in relationship[&#39;Ids&#39;]:
                cell = blocks_map[child_id]
                if cell[&#39;BlockType&#39;] == &#39;CELL&#39;:
                    row_index = cell[&#39;RowIndex&#39;]
                    col_index = cell[&#39;ColumnIndex&#39;]
                    if row_index not in rows:
                        # create new row
                        rows[row_index] = {}
                        
                    # get the text value
                    rows[row_index][col_index] = get_text(cell, blocks_map)
    return rows

def get_text(result, blocks_map):
    text = &#39;&#39;
    if &#39;Relationships&#39; in result:
        for relationship in result[&#39;Relationships&#39;]:
            if relationship[&#39;Type&#39;] == &#39;CHILD&#39;:
                if isinstance(relationship[&#39;Ids&#39;], str):     # Modified here
                    relationship_ids = [relationship[&#39;Ids&#39;]]
                else: 
                    relationship_ids = relationship[&#39;Ids&#39;]
                for child_id in relationship_ids:
                    word = blocks_map[child_id]
                    if word[&#39;BlockType&#39;] == &#39;WORD&#39;:
                        text += word[&#39;Text&#39;] + &#39; &#39;
                        
    return text

def get_table_csv_results(response):
    blocks = response[&#39;Blocks&#39;] # Modified here
    blocks_map = {}
    table_blocks = []
    for block in blocks:
        blocks_map[block[&#39;Id&#39;]] = block
        if block[&#39;BlockType&#39;] == &quot;TABLE&quot;:
            table_blocks.append(block)
            
    if len(table_blocks) &lt;= 0:
        return &quot;&lt;b&gt; NO Table FOUND &lt;/b&gt;&quot;
        
    csv = &#39;&#39;
    for index, table in enumerate(table_blocks):
        csv += generate_table_csv(table, blocks_map, index +1)
        csv += &#39;\n\n&#39;
    return csv

def generate_table_csv(table_result, blocks_map, table_index):
    rows = get_rows_columns_map(table_result, blocks_map)
    table_id = &#39;Table_&#39; + str(table_index)
    # get cells.
    csv = &#39;Table: {0}\n\n&#39;.format(table_id)
    for row_index, cols in rows.items():
        for col_index, text in cols.items():
            csv += &#39;{}&#39;.format(text) + &quot;\t&quot;
        csv += &#39;\n&#39;
    csv += &#39;\n\n\n&#39;
    return csv
</code></pre>
<p>We called our Python “get_table_csv_results” function from reticulate (as py$get_table_csv_results()) and show the raw parsed unparsed text below. We will not show the clean up here, but please refer to our Github repo for the code which we used.</p>
<pre class="r"><code>page &lt;- py$get_table_csv_results(response)

cat(page)</code></pre>
<pre><code>Table: Table_1

    General Fund    Governmental Funds  Governmental Funds  
Assets              
Cash and investments -- unrestricted    $ 9,663,898     $ 21,470,155    $ 31,134,053    
Cash and investments - restricted (for stabilization                
purposes)   3,172,925   -   3,172,925   
Receivables:                
Property taxes  1,266,214   --  1,266,214   
Motor vehicle excise    879,694     -   879,694     
Tax liens and foreclosures  2,110,587   --  2,110,587   
User charges    557,376     --  557,376     
Intergovernmenta    160,060     2,728,377   2,888,437   
Other   5,584,192   2,184,952   7,769,144   
Due from ARA    616,048     --  616,048     
Total assets    24,010,994  26,383,484  50,394,478  
Deferred outflows of resources              
None    -   --  -   
Total deferred outflows of resources    -   --  -   
Total assets and deferred outflows of resources     $ 24,010,994    $ 26,383,484    $ 50,394,478    
Liabilities                 
Warrants payable    $ 1,850,514     $ 1,745,496     $ 3,596,010     
Accounts payable and accrued expenses   682,383     311,354     993,737     
Retainage payable   -   164,392     164,392     
Due to federal and state governments    -   19,101  19,101  
Notes payable   -   6,499,066   6,499,066   
Total liabilities   2,532,897   8,739,409   11,272,306  
Deferred inflows of resources               
Property taxes paid in advance  62,260  -   62,260  
Deferred property tax revenues  3,809,278   -   3,809,278   
Deferred user fees and fines    6,141,568   --  6,141,568   
Deferred revenue from ARA   616,048         616,048     
Unearned income     -   8,240   8,240   
Deferred grant income   -   253,192     253,192     
Deferred loan income    -   2,124,915   2,124,915   
Total deferred inflows of resources     10,629,154  2,386,347   13,015,501  
Fund balance                
Nonspendable    -   315,478     315,478     
Restricted  -   7,235,505   7,235,505   
Committed   3,172,925   9,500,776   12,673,701  
Assigned    2,100,746   --  2,100,746   
Unassigned  5,575,272   (1,794,031)     3,781,241   
Total fund balance  10,848,943  15,257,728  26,106,671  
Total liabilities, deferred inflows of resources and fund balance   $ 24,010,994    $ 26,383,484    $ 50,394,478    </code></pre>
</div>
<div id="comparing-the-textract-results" class="section level1">
<h1>Comparing the Textract Results</h1>
<p>We started with 29 municipalities where there were problems matching the manually extracted data. We discovered that two of those had used scanned PDFs (ie: the auditor put the document on a scanner before converting to PDF), so pdftools couldn’t recognize the data, and we couldn’t get page numbers to send to Textract. Of those sent to Textract, most tables were not able to be parsed. Thus, of the 5% of cases which didn’t work with Tabulizer, we successfully extracted 83/125 (almost 70%) with Textract for about $2. We also didn’t spend to much time fine tuning our regex and cleaning of the raw Textract output, so if this were going to be a repeated process, it could likely be further improved.</p>
<pre class="r"><code>textract_compare &lt;- 
  readxl::read_xls(&quot;~/Desktop/David/Projects/pdf_cafr_parse/textract_compare.xls&quot;)
textract_compare &lt;- setDT(textract_compare)

# Percentage correct
sum(as.matrix(textract_compare[,.SD, .SDcols=patterns(&quot;diff&quot;)])==0)/125</code></pre>
<pre><code>[1] 0.664</code></pre>
<pre class="r"><code># Show bad cases
DT::datatable(textract_compare[, .SD, .SDcols=patterns(&quot;diff|muni&quot;)])</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26"],["attleboro","boston","chatham","concord","dartmouth","dukes_county","east_bridgewater","eastham","fall_river","franklin","hingham","hudson","malden","mashpee","methuen","millbury","montague","newton","rockland","sandwich","swansea","walpole","waltham","westford","winchendon","winchester"],[-2100746,-499688811,-4820067,0,0,0,0,0,0,0,0,0,-6469349,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1987210,-780620598,0,0,0,0,0,724963,0,0,0,0,-11234830,4421177,0,0,0,0,0,0,428494,0,0,0,-2203949,0],[-194452330,-3727320948,0,-150966028,0,-13517342,0,0,-399689317,0,0,-131479222,-27238304,0,0,0,-2866368,-559727406,0,-90915861,-1075479,0,0,-142358561,-40275169,0],[0,-2501770000,0,-4593392,0,0,-64218253,0,0,9338351,0,-116078697,0,-823038,-1231909,0,0,0,0,0,-53534162,0,0,0,4541744,0],[0,-1741636000,0,-242041449,0,0,-10237445,0,-392638228,-147040675,0,-17044118,-102881924,-41664707,16696664,-48934,0,-442618721,0,-18591423,-15323890,0,0,0,15585851,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>muni<\/th>\n      <th>diff_assigned<\/th>\n      <th>diff_unassigned<\/th>\n      <th>diff_total_exp<\/th>\n      <th>diff_unrestricted<\/th>\n      <th>diff_net_position<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<p>As reminder of the tools demonstrated in this series,</p>
<p>1/ How to find the location of a table on a page with regex matching and pdftools <a href="https://redwallanalytics.com/2020/04/06/tabulizer-and-pdftools-togeteher-as-super-powers-part-2/">Tabulizer and pdftools Together as Super-powers</a></p>
<p>2/ How to extract a particular page from a pdf with pdftools <a href="https://redwallanalytics.com/2020/04/06/tabulizer-and-pdftools-togeteher-as-super-powers-part-2/">Tabulizer and pdftools Together as Super-powers</a></p>
<p>3/ How to aggregate multiple PDF pages together <a href="https://redwallanalytics.com/2020/04/06/tabulizer-and-pdftools-togeteher-as-super-powers-part-2/">Tabulizer and pdftools Together as Super-powers</a></p>
<p>4/</p>
</div>
